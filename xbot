#!/usr/bin/env php
<?php

use Al3x5\xBot\Config;

if (file_exists('vendor/autoload.php')) {
    require_once 'vendor/autoload.php';
}

// Config
if (file_exists('config.php')) {
    $cfg = require 'config.php';
}

use Al3x5\xBot\Bot;
use Al3x5\xBot\Commands\HookAboutCommand;
use Al3x5\xBot\Commands\HookDeleteCommand;
use Al3x5\xBot\Commands\HookInfoCommand;
use Al3x5\xBot\Commands\HookSetCommand;
use Al3x5\xBot\Commands\InstallCommand;
use Al3x5\xBot\Commands\MakeCommandCommand;
use Al3x5\xBot\Commands\RegisterCommand;
use Al3x5\xBot\Commands\TelegramCallbackCommand;
use Al3x5\xBot\Commands\TelegramCommandCommand;
use Al3x5\xBot\Commands\TelegramConversationCommand;
use Al3x5\xBot\Commands\TelegramHandlerCommand;
use Al3x5\xBot\Commands\TelegramMiddlewareCommand;
use Symfony\Component\Console\Application;

if (!empty($cfg)) {
    Config::init($cfg);
}

$app = new Application(Bot::NAME, 'v' . Bot::VERSION);

// ... register commands
$app->addCommand(new InstallCommand());
$app->addCommand(new RegisterCommand());
//webhook
$app->addCommand(new HookSetCommand());
$app->addCommand(new HookDeleteCommand());
$app->addCommand(new HookInfoCommand());
$app->addCommand(new HookAboutCommand());
//make
if (!strpos(__DIR__, 'vendor')) {
    $app->addCommand(new MakeCommandCommand());
}
//telegram
$app->addCommand(new TelegramCommandCommand());
$app->addCommand(new TelegramCallbackCommand());
$app->addCommand(new TelegramConversationCommand());
$app->addCommand(new TelegramHandlerCommand());
$app->addCommand(new TelegramMiddlewareCommand());

if (
    !file_exists(InstallCommand::configFile()) &&
    !file_exists('artisan')
) {
    $app->setDefaultCommand('install');
}

$app->run();
